# –û—Ü—ñ–Ω–∫–∞ –ö–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ —Ç–∞ –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ Web Worker

–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –º—ñ—Å—Ç–∏—Ç—å —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ñ–æ–Ω–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫—É —Å–∏–º—É–ª—è—Ü—ñ—ó (**Web Worker**) —É –ø—Ä–æ–µ–∫—Ç—ñ Entropia 3D.

## üèõÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏–π –û–≥–ª—è–¥

–°–∏–º—É–ª—è—Ü—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –º–æ–¥–µ–ª—å **Off-main-thread Architecture**. –û—Å–Ω–æ–≤–Ω–µ –æ–±—á–∏—Å–ª—é–≤–∞–ª—å–Ω–µ —è–¥—Ä–æ (`SimulationEngine`) –ø–æ–≤–Ω—ñ—Å—Ç—é —ñ–∑–æ–ª—å–æ–≤–∞–Ω–µ —É —Ñ–æ–Ω–æ–≤–æ–º—É –ø–æ—Ç–æ—Ü—ñ, —â–æ –¥–æ–∑–≤–æ–ª—è—î –¥–æ—Å—è–≥—Ç–∏:
1. **–ü–ª–∞–≤–Ω–æ—Å—Ç—ñ UI**: –í–∞–∂–∫—ñ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω—ñ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è (—Ñ—ñ–∑–∏–∫–∞, –∫–æ–ª—ñ–∑—ñ—ó, –ø–æ–≤–µ–¥—ñ–Ω–∫–∞) –Ω–µ –±–ª–æ–∫—É—é—Ç—å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É (60+ FPS).
2. **–ü–∞—Ä–∞–ª–µ–ª—ñ–∑–º—É**: –û–±—Ä–æ–±–∫–∞ –¥–∞–Ω–∏—Ö —Å–∏–º—É–ª—è—Ü—ñ—ó –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ –∑ —Ä–æ–±–æ—Ç–æ—é React —Ç–∞ Three.js.

### –ö–ª—é—á–æ–≤—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
- [simulation.worker.ts](../src/simulation/simulation.worker.ts): –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É –≤–æ—Ä–∫–µ—Ä–∞, —è–∫–∞ —Ö–æ—Å—Ç–∏—Ç—å –µ–∫–∑–µ–º–ø–ª—è—Ä `SimulationEngine`.
- [EngineProxy.ts](../src/simulation/EngineProxy.ts): Main-thread —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î –ø—Ä–æ–∑–æ—Ä—É –≤–∑–∞—î–º–æ–¥—ñ—é –∑ –≤–æ—Ä–∫–µ—Ä–æ–º.
- [WorkerMessages.ts](../src/simulation/WorkerMessages.ts): –ü—Ä–æ—Ç–æ–∫–æ–ª —Ç–∏–ø—ñ–∑–æ–≤–∞–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å.

---

## ‚öñÔ∏è –û—Ü—ñ–Ω–∫–∞ –ö–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ

### 1. –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –°—Ç–∞–Ω—ñ–≤
–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **One-Way Data Flow** —á–µ—Ä–µ–∑ `postMessage`:
- **Main ‚Üí Worker**: –ö–æ–º–∞–Ω–¥–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è (`init`, `update`, `setConfig`).
- **Worker ‚Üí Main**: –î–∞–Ω—ñ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É —Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (`updated`, `stats`).

> [!NOTE]
> –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `SharedArrayBuffer` (—è–∫—â–æ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º) –¥–æ–∑–≤–æ–ª—è—î —É–Ω–∏–∫–Ω—É—Ç–∏ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ –º–∏—Ç—Ç—î–≤–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –ø–∞–º'—è—Ç—ñ –∑ –æ–±–æ—Ö –ø–æ—Ç–æ–∫—ñ–≤.

### 2. –ö–µ—Ä—É–≤–∞–Ω–Ω—è –ë—É—Ñ–µ—Ä–∞–º–∏
–°–∏—Å—Ç–µ–º–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `BufferManager` –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–∞–º'—è—Ç—Ç—é:
- **–ì—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å**: –ó–∞–ø–æ–±—ñ–≥–∞—î —á–∞—Å—Ç–∏–º —Ä–µ–∞–ª–æ–∫–∞—Ü—ñ—è–º –ø—Ä–∏ –Ω–µ–∑–Ω–∞—á–Ω–∏—Ö –∫–æ–ª–∏–≤–∞–Ω–Ω—è—Ö –ø–æ–ø—É–ª—è—Ü—ñ—ó (–∑–∞–ø–∞—Å 25-50%).
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Ç–∞ –∑–≤—É–∂–µ–Ω–Ω—è –±—É—Ñ–µ—Ä—ñ–≤ –±–∞–∑—É—é—á–∏—Å—å –Ω–∞ –ø–æ—Ç–æ—á–Ω—ñ–π –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∞–≥–µ–Ω—Ç—ñ–≤.

### 3. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è
–ö–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å –æ–±—Ä–æ–±–∫–∏ –¥–∞–Ω–∏—Ö —É –≤–æ—Ä–∫–µ—Ä—ñ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏:
- [Engine.buffers.test.ts](../src/simulation/__tests__/Engine.buffers.test.ts): –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ –±—É—Ñ–µ—Ä—ñ–≤ —Ç–∞ –¥–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–æ—Å—Ç—ñ –µ–∫—Å–ø–æ—Ä—Ç—É —Å—Ç–∞–Ω—ñ–≤.

---

## ‚ö° –û—Ü—ñ–Ω–∫–∞ –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

### 1. Zero-Copy Data Transfer
–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **Transferable Objects** –¥–ª—è `TypedArrays` (Float32Array) –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–µ –¥–ª—è FPS:
- –î–∞–Ω—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫—É —à–ª—è—Ö–æ–º –ø–µ—Ä–µ–¥–∞—á—ñ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è –ø–∞–º'—è—Ç—Ç—é, –∞ –Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è.
- –¶–µ –º—ñ–Ω—ñ–º—ñ–∑—É—î –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ Garbage Collector.

### 2. –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å
–í–æ—Ä–∫–µ—Ä –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–æ–±–ª—è—î –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è –ø–æ–ø—É–ª—è—Ü—ñ—ó –∑–∞–≤–¥—è–∫–∏:
- **Spatial Hash Grid**: –û–±—Ä–æ–±–∫–∞ –∫–æ–ª—ñ–∑—ñ–π O(1) —É —Å–µ—Ä–µ–¥–Ω—å–æ–º—É.
- **SOA (Service Oriented Architecture)**: –†–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –æ–±–æ–≤'—è–∑–∫—ñ–≤ –º—ñ–∂ —Å–µ—Ä–≤—ñ—Å–∞–º–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≤–æ—Ä–∫–µ—Ä–∞.

---

## üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è

1. **–£–Ω—ñ—Ñ—ñ–∫–∞—Ü—ñ—è –¶–∏–∫–ª—ñ–≤ –û–Ω–æ–≤–ª–µ–Ω–Ω—è**: –ù–∞—Ä–∞–∑—ñ —ñ `EngineProxy`, —ñ `simulation.worker.ts` –º–∞—é—Ç—å –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (`setInterval` vs `requestAnimationFrame`). –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–∞ —Ç–∏–∫–∞–º–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é –Ω–∞ –≤–æ—Ä–∫–µ—Ä –¥–ª—è –º—ñ–Ω—ñ–º—ñ–∑–∞—Ü—ñ—ó `postMessage` –æ–≤–µ—Ä—Ö–µ–¥—É.
2. **Batch Config Updates**: –û–±'—î–¥–Ω–∞–Ω–Ω—è –¥–µ–∫—ñ–ª—å–∫–æ—Ö –∑–º—ñ–Ω –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –≤ –æ–¥–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∑–º–µ–Ω—à–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω—å –≤–æ—Ä–∫–µ—Ä–∞.
3. **OffscreenCanvas** (–ú–∞–π–±—É—Ç–Ω—î): –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è —á–∞—Å—Ç–∏–Ω–∏ –ª–æ–≥—ñ–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É –≤ –≤–æ—Ä–∫–µ—Ä —á–µ—Ä–µ–∑ `OffscreenCanvas` –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó —Ä–æ–∑–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥–æ–ª–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫—É.

---

**–í–∏—Å–Ω–æ–≤–æ–∫**: –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è Web Worker —É –ø—Ä–æ–µ–∫—Ç—ñ Entropia 3D –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤–∏—Å–æ–∫–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ —Å—Ç–∞–±—ñ–ª—å–Ω—É —Ä–æ–±–æ—Ç—É —Å–∫–ª–∞–¥–Ω–∏—Ö –µ–≤–æ–ª—é—Ü—ñ–π–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π —É –±—Ä–∞—É–∑–µ—Ä—ñ.
